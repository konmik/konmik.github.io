<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Why lambdas matter (even on Android) :: Konstantin Mikheev&#39;s programming blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description"
  content="A little knowledge exchange from an active lambdas user.
Term: Lambda is an anonymous function.
" />
<meta name="keywords"
  content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="konmik.com/posts/why_lambdas_matter_even_on_android/" />


<link rel="stylesheet" href="konmik.com/assets/style.css">

<link rel="stylesheet" href="konmik.com/assets/green.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144"
  href="konmik.com/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="konmik.com/img/favicon/green.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title"
  content="Why lambdas matter (even on Android) :: Konstantin Mikheev&#39;s programming blog — " />
<meta name="twitter:description"
  content="A little knowledge exchange from an active lambdas user.
Term: Lambda is an anonymous function.
" />
<meta name="twitter:site" content="konmik.com/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title"
  content="Why lambdas matter (even on Android) :: Konstantin Mikheev&#39;s programming blog — ">
<meta property="og:description"
  content="A little knowledge exchange from an active lambdas user.
Term: Lambda is an anonymous function.
" />
<meta property="og:url" content="konmik.com/posts/why_lambdas_matter_even_on_android/" />
<meta property="og:site_name" content="Why lambdas matter (even on Android)" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


<meta property="article:published_time" content="2016-01-06 00:00:00 &#43;0000 UTC" />










</head>
<body class="">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="konmik.com/">
  <div class="logo">
    Konstantin Mikheev&#39;s programming blog
  </div>
</a>
    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="konmik.com/index.xml">[RSS]</a></li>
        
      
        
          <li><a href="twitter.com/sirstripy">[Twitter]</a></li>
        
      
        
          <li><a href="github.com/konmik">[GitHub]</a></li>
        
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="konmik.com/index.xml">[RSS]</a></li>
      
    
      
        <li><a href="twitter.com/sirstripy">[Twitter]</a></li>
      
    
      
        <li><a href="github.com/konmik">[GitHub]</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="konmik.com/posts/why_lambdas_matter_even_on_android/">Why lambdas matter (even on Android)</a></h1>
  <div class="post-meta">
    
    <span class="post-date">
      2016-01-06
    </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="konmik.com/tags/java/">Java</a>&nbsp;
    
    #<a href="konmik.com/tags/android/">Android</a>&nbsp;
    
    #<a href="konmik.com/tags/programming-theory/">Programming theory</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    <p>A little knowledge exchange from an active lambdas user.</p>
<p><em>Term: <strong>Lambda</strong> is an anonymous function.</em></p>
<h3 id="introduction">Introduction</h3>
<p>I started writing computer programs about twenty
years ago, when C++ has just been released.
Applications written entirely in Assembler were not rare those days.
We had Pascal, C, Assembler, FoxPro.
Garbage collection? If you wanted to create an
object - please, allocate and release it&rsquo;s memory manually!
We had an entire class of languages without stack!
And they were quite popular in the business area.</p>
<p>OOP was for weird guys.
Believe me, if you would start studying programming 20 years ago,
the OOP architecture looked <em>very</em> alien.
You knew that there are <em>no</em> objects inside computers!
There are only data structures and code.
Data do not have behavior.
It just lays there, waiting for what you&rsquo;re going to do with it.</p>
<p>For us, who started writing programs without OOP,
the only advantage OOP has is that it allows to pass a reference to a function
(via an overridden method)
and execute the function with arguments (object fields) <em>later</em>.
Sorry, there are no other real (not imaginary) benefits of OOP.</p>
<p>Finally, we on Android got the possibility to pass functions without
architecting and constructing classes first!
Amazing! Lambda is a fresh air of freedom.
Now we don&rsquo;t need to invent overcomplicated
relationships between variables and to apply entangled patterns
just to compose actions!</p>
<p><em>Pure power</em></p>
<p>The more flexible our code is, the more
efficient it is. Having a function that can be applied in 100 cases
is more efficient (more powerful) than having 10 functions that
should be applied in those 100 cases instead.</p>
<p><em>Having to write 10 lines of code instead of 100 lines <strong>is</strong> power of
a programming language.</em></p>
<p>Yes, it is true that we <em>can</em> do everything without lambdas.
It is also true that we can do everything without Java, using C++ or even pure Assembler.
The main difference we have is the time spent on each feature and the amount of
time spent while fixing bugs.</p>
<p>Here are my simple practical examples of creation of more flexible code using lambdas.
We&rsquo;ll walk through some examples and see how they can change usual development practices we have.</p>
<p>I hope these examples will be useful to make more code better
(powerful, flexible and reliable).</p>
<h3 id="syntax-extension">Syntax extension</h3>
<p>Let&rsquo;s start from something simple.</p>
<p>Sometimes Java is too verbose.
We can tweak some stuff to make it more digestible.</p>
<h5 id="rethrow">Rethrow</h5>
<p><code>rethrow</code> is the function I use most often. It allows to rethrow an exception from
any other function that has checked exceptions declared.
Sure, it is not a good idea to blindly rethrow <em>all</em> exceptions, but if
you want your app to crash (fail-fast strategy), why bother?</p>
<p>Was:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    Thread.<span style="color:#a6e22e">sleep</span>(100);
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Became:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>rethrow(() <span style="color:#f92672">-&gt;</span> Thread.<span style="color:#a6e22e">sleep</span>(100));
</span></span></code></pre></div><p>And even:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">byte</span> <span style="color:#f92672">=</span> rethrow(() <span style="color:#f92672">-&gt;</span> inputStream.<span style="color:#a6e22e">read</span>());
</span></span></code></pre></div><p>Implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">RunnableThrows</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() <span style="color:#66d9ef">throws</span> Exception;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">rethrow</span>(Callable<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> callable) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> callable.<span style="color:#a6e22e">call</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> rethrow(e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">rethrow</span>(RunnableThrows runnable) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        runnable.<span style="color:#a6e22e">run</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> rethrow(e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * http://www.mail-archive.com/javaposse@googlegroups.com/msg05984.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> RuntimeException <span style="color:#a6e22e">rethrow</span>(Throwable throwable) {
</span></span><span style="display:flex;"><span>    sneakyThrow0(throwable);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> Throwable<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sneakyThrow0</span>(Throwable throwable) <span style="color:#66d9ef">throws</span> T {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> (T) throwable;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This <code>sneakyThrow0</code> just rethrows a checked exception without wrapping it into
<code>RuntimeException</code>, so the exception&rsquo;s stacktrace becomes shorter.</p>
<h5 id="suppress">Suppress</h5>
<p><code>suppress</code> is a brother of <code>rethrow</code>. It suppresses a thrown exception.</p>
<p>Instead of:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>BigDecimal number <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    number <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BigDecimal(string);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">catch</span> (NumberFormatException ignored) {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Write:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>BugDecimal number <span style="color:#f92672">=</span> suppress(() <span style="color:#f92672">-&gt;</span> BigDecimal(string));
</span></span></code></pre></div><p>You can also be specific:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>BugDecimal number <span style="color:#f92672">=</span> suppress(() <span style="color:#f92672">-&gt;</span> BigDecimal(string), NumberFormatException.<span style="color:#a6e22e">class</span>);
</span></span></code></pre></div><p>Implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Nullable</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">suppress</span>(Callable<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> callable, Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Throwable<span style="color:#f92672">&gt;</span>... throwables) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> callable.<span style="color:#a6e22e">call</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (Throwable thrown) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (throwables.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> 0)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Class<span style="color:#f92672">&lt;?&gt;</span> throwable : throwables) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (throwable.<span style="color:#a6e22e">isAssignableFrom</span>(thrown.<span style="color:#a6e22e">getClass</span>())) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> rethrow(thrown);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>You can modify <code>suppress</code> to return boolean, <code>Optional</code> or to have any other tricky behavior.</p>
<h5 id="delayed">Delayed</h5>
<p><code>Delayed</code> is a class that gives access to a variable that should be initialized on demand
and cached for later usage.</p>
<p>Was:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> value;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> isValueInitialized;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getValue</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>isValueInitialized) {
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">=</span> calculateValue();
</span></span><span style="display:flex;"><span>        isValueInitialized <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> value;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Became:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Delayed<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> value <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Delayed(() <span style="color:#f92672">-&gt;</span> calculateValue());
</span></span></code></pre></div><p>This kind of variables are quite helpful when it comes to declaring data that does not exist at the moment
of the class instantiation. On Android we can refer to Activity&rsquo;s extras like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Delayed<span style="color:#f92672">&lt;</span>Record<span style="color:#f92672">&gt;</span> record <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Delayed<span style="color:#f92672">&lt;&gt;</span>(() <span style="color:#f92672">-&gt;</span> getIntent().<span style="color:#a6e22e">getParcelableExtra</span>(<span style="color:#e6db74">&#34;record&#34;</span>));
</span></span></code></pre></div><p>Implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Delayed</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Factory</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        T <span style="color:#a6e22e">create</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Factory<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> factory;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> T value;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> initialized;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Delayed</span>(Factory<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> factory) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">factory</span> <span style="color:#f92672">=</span> factory;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> T <span style="color:#a6e22e">get</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>initialized) {
</span></span><span style="display:flex;"><span>            value <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">create</span>();
</span></span><span style="display:flex;"><span>            initialized <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This pattern allows to solve one of fundamental problems: we don&rsquo;t want to calculate a value
twice but we don&rsquo;t want to manually control the variable initialization/usage order.</p>
<h3 id="algorithm-strategy-policy-pattern">Algorithm (Strategy, Policy) pattern</h3>
<p><em>Term: <strong>Algorithm</strong> is a procedure or formula for solving a problem.</em></p>
<p>Technically, any sequence of actions that has more than one step is an algorithm.</p>
<p>One of the most widely used OOP patterns disappears in languages that have lambdas.</p>
<p>There is a known example of the pattern: <code>Collections.sort(list, comparator)</code>
function. Instead of implementing your own class which has <code>Comparator</code> implemented,
you can just pass a lambda into the <code>sort</code> function.</p>
<p>Here is another example. How many times did you write something like this?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">copy</span>(InputStream in, OutputStream out) <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>4096<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> read;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ((read <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">read</span>(buffer)) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1) {
</span></span><span style="display:flex;"><span>        out.<span style="color:#a6e22e">write</span>(buffer, 0, read);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>But what if you want to copy not from <code>InputStream</code> into <code>OutputStream</code> but from any other
pool of data into another pool?
OOP way is to implement <code>InputStream</code> and <code>OutputStream</code>
every time you need a buffered copying. This is very hard so nobody actually do this and we have
tons of buffered copying functions everywhere.</p>
<p>Here is an algorithm that does not depend upon a specific class.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Action1Throws</span><span style="color:#f92672">&lt;</span>T1, E <span style="color:#66d9ef">extends</span> Throwable<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">call</span>(T1 t) <span style="color:#66d9ef">throws</span> E;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Func1Throws</span><span style="color:#f92672">&lt;</span>T1, R, E <span style="color:#66d9ef">extends</span> Throwable<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    R <span style="color:#a6e22e">call</span>(T1 t1) <span style="color:#66d9ef">throws</span> E;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>E1 <span style="color:#66d9ef">extends</span> Throwable, E2 <span style="color:#66d9ef">extends</span> Throwable<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">bufferedCopy</span>(Func1Throws<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span>, Integer, E1<span style="color:#f92672">&gt;</span> reader, Action1Throws<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span>, E2<span style="color:#f92672">&gt;</span> consumer) <span style="color:#66d9ef">throws</span> E1, E2 {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>4096<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> read;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ((read <span style="color:#f92672">=</span> reader.<span style="color:#a6e22e">call</span>(buffer)) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1) {
</span></span><span style="display:flex;"><span>        consumer.<span style="color:#a6e22e">call</span>(read <span style="color:#f92672">==</span> buffer.<span style="color:#a6e22e">length</span> <span style="color:#f92672">?</span> buffer : Arrays.<span style="color:#a6e22e">copyOf</span>(buffer, read));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Yep, the function declaration looks terrible. :D This is Java, a quite verbose beast.</p>
<p>But now we can reuse the code!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">md5</span>(InputStream in) <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>    MessageDigest digest <span style="color:#f92672">=</span> rethrow(() <span style="color:#f92672">-&gt;</span> MessageDigest.<span style="color:#a6e22e">getInstance</span>(<span style="color:#e6db74">&#34;MD5&#34;</span>));
</span></span><span style="display:flex;"><span>    bufferedCopy(in::read, buffer <span style="color:#f92672">-&gt;</span> digest.<span style="color:#a6e22e">update</span>(buffer, 0, buffer.<span style="color:#a6e22e">length</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BigInteger(1, digest.<span style="color:#a6e22e">digest</span>())
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">toString</span>(16).<span style="color:#a6e22e">substring</span>(0, 32).<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The OOP version of Algorithm pattern was very poor. Now we can <em>really</em> reuse our algorithms.</p>
<p>Consequences of this pattern replacement are fundamental.
In computer science we have two basic things - code and data.
We can modify data in many ways but our code is not so easily modifiable (at least in Java).
This is weird because latest &ldquo;best practices&rdquo; say that we must rely on
<em>immutable</em> data and the problem we&rsquo;re facing every day is that
our code always needs better flexibility!</p>
<p><em>Term: <strong>Dependency</strong> is an object that is referenced by another object.</em></p>
<p>In OOP languages we achieve code modification by leveraging inheritance
and building dependency graphs that behave
differently when we replace some of graph nodes.
This is an <em>extremely</em> complicated solution.</p>
<p>Class graphs are hard to work with. You modify an object in one place
something other breaks in another place.
This happens <em>always</em> even with greatest professionals,
this is our OOP curse.</p>
<p>Good class graphs are hard to create. They are extremely hard to test.
(Hey, I know that someone will say that everything is easy, but!
Please, recall how you tried to understand a dependency framework for the first time.
Some of us have huge ego and short memory, so there are probably some people who
will still say that it was easy and try to play wunderkinds around this.
Just don&rsquo;t buy it. (Some of us <em>are</em> wunderkinds, but this is a different story.))</p>
<p><strong>Lambdas allow easy, safe code modifications without the need in OOP.
We don&rsquo;t need to imagine that data have behavior for the sake of code modification anymore!</strong></p>
<h3 id="streams">Streams</h3>
<p>The fact that now we can reuse our algorithms raised an obvious question:
&ldquo;What are the most usual algorithms that can be reused?&rdquo;</p>
<p>Traditionally, functional languages like Haskell and LISP have libraries
of algorithms for data processing.
Java-based languages (Scala, Kotlin) also have them, and
Java 8 got it&rsquo;s own library: &ldquo;Java SE 8 Streams&rdquo;.</p>
<p>We don&rsquo;t get Java SE 8 Streams library on Android with Retrolambda, but if you&rsquo;re interested,
there is a couple of alternatives:
<a href="https://github.com/konmik/solid">Solid</a>,
<a href="https://github.com/aNNiMON/Lightweight-Stream-API">Lightweight-Stream-API</a>.</p>
<p>How streams look like? (Solid)</p>
<p>Was:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">tree</span>(File path) {
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    result.<span style="color:#a6e22e">add</span>(path);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    File<span style="color:#f92672">[]</span> files <span style="color:#f92672">=</span> path.<span style="color:#a6e22e">listFiles</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (file <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (File file : files) {
</span></span><span style="display:flex;"><span>        files.<span style="color:#a6e22e">addAll</span>(tree(file));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> files;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Became:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Stream<span style="color:#f92672">&lt;</span>File<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">tree</span>(File path) {
</span></span><span style="display:flex;"><span>    File<span style="color:#f92672">[]</span> files <span style="color:#f92672">=</span> path.<span style="color:#a6e22e">listFiles</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> files <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> of(path) :
</span></span><span style="display:flex;"><span>        of(path).<span style="color:#a6e22e">merge</span>(stream(files).<span style="color:#a6e22e">flatMap</span>(it <span style="color:#f92672">-&gt;</span> tree(it)));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The syntax can look weird and you need to study several new methods,
but it is just a matter of habit. It took just one month for me
to completely switch my way of thinking about data.</p>
<p>Another awesome library with reusable algorithms
is <a href="https://github.com/ReactiveX/RxJava">RxJava</a>.
It allows to reuse multithreading and event-processing operations.
The library is hard to get at
the beginning, but once you start, you can&rsquo;t stop using it everywhere.
I can easily imagine an application
where all events are processed with RxJava instead of usual OOP method calls.</p>
<h3 id="transforming-a-listener-class-into-lambda">Transforming a listener class into lambda</h3>
<p>Here is a trick on the final note.</p>
<p>Sometimes you want to set a listener, but if the listener is an interface
with several methods, such interfaces can not be substituted by lambdas.</p>
<p>Was:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>animator.<span style="color:#a6e22e">addListener</span>(<span style="color:#66d9ef">new</span> Animator.<span style="color:#a6e22e">AnimatorListener</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onAnimationStart</span>(Animator animation) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onAnimationEnd</span>(Animator animation) {
</span></span><span style="display:flex;"><span>        view.<span style="color:#a6e22e">setVisibility</span>(GONE)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Became:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>animator.<span style="color:#a6e22e">addListener</span>(<span style="color:#66d9ef">new</span> AnimatorEndListener(() <span style="color:#f92672">-&gt;</span> view.<span style="color:#a6e22e">setVisibility</span>(GONE));
</span></span></code></pre></div><p>With:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnimatorEndListener</span> <span style="color:#66d9ef">implements</span> Animator.<span style="color:#a6e22e">AnimatorListener</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Runnable onEnd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">AnimatorEndListener</span>(Runnable onEnd) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">onEnd</span> <span style="color:#f92672">=</span> onEnd;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onAnimationStart</span>(Animator animation) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onAnimationEnd</span>(Animator animation) {
</span></span><span style="display:flex;"><span>        onEnd.<span style="color:#a6e22e">run</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-future-of-programming-languages">The future of programming languages</h3>
<p>In the introduction I wrote about power of languages. The idea is not new. Any programmer who
knows a couple of languages with different possibilities can easily say which one has more power.</p>
<p>I highly recommend reading
<a href="http://www.paulgraham.com/avg.html">Beating the Averages</a>
by Paul Graham on this subject.
The article was written in 2001, so which language is the most powerful <em>now</em>?
Guys, you will hate me - nothing changed. The most powerful language these days is&hellip;
<a href="http://clojure.org/">Clojure</a>, a LISP dialect.</p>
<p>What does it have Java-based languages don&rsquo;t?</p>
<ul>
<li>An easy compile-time code generation and extensible syntax (unbelievable flexibility of algorithms);</li>
<li>Enforced immutability of data (awesome for architecting and multithreading);</li>
<li>A very efficient type system;</li>
<li>A uniform scientifically justified syntax which has composition as its primary intention.</li>
</ul>
<p>No, this is not possible to accomplish in Java-based languages
under any circumstances not in the near feature, not 100 years later, so LISP will always be the
most powerful language unless something specific will happen, which is unlikely.</p>
<p>We can&rsquo;t use Clojure on Android right now because of it&rsquo;s slow startup time on mobile devices.
There are different possibilities for running ClojureScript but they are not tested thoroughly yet.
I hope that we will get Clojure sooner or later.</p>
<h3 id="references">References</h3>
<p><a href="http://alvinalexander.com/scala/how-scala-killed-oop-strategy-design-pattern">How Scala killed the Strategy Pattern - Alvin Alexander</a></p>
<p><a href="http://www.paulgraham.com/avg.html">Beating the Averages - Paul Graham</a></p>
<p><a href="http://www.paulgraham.com/power.html">Succinctness is Power - Paul Graham</a></p>
<p><a href="https://www.youtube.com/watch?v=TMuno5RZNeE">SOLID Principles of Object Oriented and Agile Design - Robert C. Martin</a></p>
<p><a href="http://loup-vaillant.fr/articles/deaths-of-oop">The repeated deaths of OOP - Loup Vaillant</a></p>
<p><a href="http://www.infoq.com/presentations/Simple-Made-Easy">Simple Made Easy - Rich Hickey</a></p>
<p><a href="https://github.com/evant/gradle-retrolambda">gradle-retrolambda</a></p>
<p><a href="https://github.com/ReactiveX/RxJava">RxJava</a></p>
<p><a href="https://github.com/konmik/solid">Solid</a></p>
  </div>


  <h3>Did you like it? Share!</h3>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a1c5667151c1f30"></script>
  <div class="addthis_inline_share_toolbox"></div>


  
  <div class="pagination">
    <div class="pagination__title">
      <span class="pagination__title-h"></span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <span class="button previous">
        <a href="konmik.com/posts/managing_state_reactive_way/">
          <span class="button__icon">←</span>
          <span class="button__text">Managing state reactive way</span>
        </a>
      </span>
      
      
      <span class="button next">
        <a href="konmik.com/posts/rxjava_magic_finally_goes_away/">
          <span class="button__text">RxJava magic (finally) goes away</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  


  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    <div class="copyright copyright--user">
      <span>(c) Konstantin Mikheev 2020</span>
    </div>
</footer>

<script src="konmik.com/assets/main.js"></script>
<script src="konmik.com/assets/prism.js"></script>




  
</div>

</body>
</html>
